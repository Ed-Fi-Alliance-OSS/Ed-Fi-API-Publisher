"use strict";(self.webpackChunked_fi_api_publisher=self.webpackChunked_fi_api_publisher||[]).push([[6122],{9031:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>s,default:()=>u,frontMatter:()=>t,metadata:()=>a,toc:()=>l});var i=r(4848),o=r(8453);const t={},s="Configuration Store for PostgreSQL",a={id:"configurationstore/PostgreSql",title:"Configuration Store for PostgreSQL",description:"Enables management of individual connection settings with encryption for securely storing keys and secrets using a supplied password for symmetric key encryption using the pgcrypto extension for PostgreSQL.",source:"@site/docs/configurationstore/PostgreSql.md",sourceDirName:"configurationstore",slug:"/configurationstore/PostgreSql",permalink:"/Ed-Fi-API-Publisher/docs/configurationstore/PostgreSql",draft:!1,unlisted:!1,editUrl:"https://github.com/ed-fi-alliance-oss/Ed-Fi-API-Publisher/tree/gh-pages/pages/docs/docs/configurationstore/PostgreSql.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Configuration Store for AWS Parameter Store",permalink:"/Ed-Fi-API-Publisher/docs/configurationstore/Aws-Parameter-Store"},next:{title:"Configuration Store for SQL Server",permalink:"/Ed-Fi-API-Publisher/docs/configurationstore/Sql-Server"}},c={},l=[{value:"Create the Ed-Fi API Publisher Configuration Database and Table",id:"create-the-ed-fi-api-publisher-configuration-database-and-table",level:2},{value:"Configure API Connections",id:"configure-api-connections",level:2},{value:"Configure API Publisher",id:"configure-api-publisher",level:2},{value:"PostgreSQL Credentials",id:"postgresql-credentials",level:3},{value:"Encryption Password",id:"encryption-password",level:3}];function d(e){const n={a:"a",blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",img:"img",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"configuration-store-for-postgresql",children:"Configuration Store for PostgreSQL"}),"\n",(0,i.jsxs)(n.p,{children:["Enables management of individual connection settings with encryption for securely storing keys and secrets using a supplied password for symmetric key encryption using the ",(0,i.jsx)(n.code,{children:"pgcrypto"})," extension for PostgreSQL."]}),"\n",(0,i.jsx)(n.h2,{id:"create-the-ed-fi-api-publisher-configuration-database-and-table",children:"Create the Ed-Fi API Publisher Configuration Database and Table"}),"\n",(0,i.jsx)(n.p,{children:"First create the configuration database, as follows:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"create database edfi_api_publisher_configuration;\n"})}),"\n",(0,i.jsx)(n.p,{children:"Connect to the new database. Then create configuration table, as follows:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"create schema dbo;\r\n\r\ncreate table dbo.configuration_value\r\n(\r\n    configuration_key varchar(450) not null\r\n        constraint configuration_value_pk\r\n            primary key,\r\n    configuration_value text,\r\n    configuration_value_encrypted bytea\r\n);\r\n\r\ncreate extension if not exists pgcrypto;\n"})}),"\n",(0,i.jsx)(n.h2,{id:"configure-api-connections",children:"Configure API Connections"}),"\n",(0,i.jsxs)(n.p,{children:["Create new API connections by executing SQL statements similar to what is shown below. The ",(0,i.jsx)(n.code,{children:"pgcrypto"})," functions used below employ symmetric key encryption based on the supplied password."]}),"\n",(0,i.jsxs)(n.p,{children:["For the API Publisher, the password can be supplied via the command-line using ",(0,i.jsx)(n.code,{children:"--postgreSqlEncryptionPassword"}),", accessed through an environment variable named ",(0,i.jsx)(n.code,{children:"EdFi:ApiPublisher:ConfigurationStore:PostgreSql:EncryptionPassword"})," (or ",(0,i.jsx)(n.code,{children:"EdFi__ApiPublisher__ConfigurationStore__PostgreSql__EncryptionPassword"}),"), or through the ",(0,i.jsx)(n.em,{children:"configurationStoreSettings.json"})," file."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"-- Insert plain text values into the 'configuration_value' column\r\ninsert into dbo.configuration_value(configuration_key, configuration_value)\r\nvalues ('/ed-fi/apiPublisher/connections/Hosted_Sample_v5.2/url', 'https://api.ed-fi.org/v5.2/api/');\r\n\r\n-- Insert encrypted values into 'configuration_value_encrypted' column\r\ninsert into dbo.configuration_value(configuration_key, configuration_value_encrypted)\r\nvalues ('/ed-fi/apiPublisher/connections/Hosted_Sample_v5.2/key', pgp_sym_encrypt('RvcohKz9zHI4', 'my-secure-password'));\r\n\r\ninsert into dbo.configuration_value(configuration_key, configuration_value_encrypted)\r\nvalues ('/ed-fi/apiPublisher/connections/Hosted_Sample_v5.2/secret', pgp_sym_encrypt('E1iEFusaNf81xzCxwHfbolkC', 'my-secure-password'));\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"PostgreSQL Configuration Store",src:r(2850).A+"",width:"3236",height:"431"})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["NOTE: The name of the connection (",(0,i.jsx)(n.code,{children:"Hosted_Sample_v5.2"})," in the example above) should not contain spaces since a primary usage scenario is to provide the name in a command-line argument to the utility (i.e. ",(0,i.jsx)(n.code,{children:"--sourceName=Hosted_Sample_v5.2"}),")."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"configure-api-publisher",children:"Configure API Publisher"}),"\n",(0,i.jsxs)(n.p,{children:["To use the PostgreSQL Configuration Store, change the ",(0,i.jsx)(n.code,{children:"provider"})," setting in the ",(0,i.jsx)(n.em,{children:"configurationStoreSettings.json"})," file to ",(0,i.jsx)(n.code,{children:"postgreSql"}),", as shown below."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\r\n  "configurationStore": {\r\n    "provider": "postgreSql",\r\n    "postgreSql": {\r\n      "connectionString": "Host=localhost;Database=edfi_api_publisher_configuration",\r\n      "encryptionPassword": ""\r\n    }\r\n  }\r\n}    \n'})}),"\n",(0,i.jsx)(n.h3,{id:"postgresql-credentials",children:"PostgreSQL Credentials"}),"\n",(0,i.jsxs)(n.p,{children:["The Configuration Store implementation uses the Npgsql driver which ",(0,i.jsx)(n.a,{href:"https://www.npgsql.org/doc/connection-string-parameters.html",children:"provides a few mechanisms"})," for providing credentials in a more secure manner than embedding them in the connection string in the configuration file shown above."]}),"\n",(0,i.jsxs)(n.p,{children:["Recommendation is to either add the ",(0,i.jsx)(n.code,{children:"Username"})," connection string parameter into the configured connection string above, or to set the ",(0,i.jsx)(n.code,{children:"PGUSER"})," environment variable to contain the user name."]}),"\n",(0,i.jsxs)(n.p,{children:["Then, create a ",(0,i.jsx)(n.a,{href:"https://www.postgresql.org/docs/current/libpq-pgpass.html",children:"PostgreSQL password file"})," to supply the ",(0,i.jsx)(n.em,{children:"password"})," at runtime. The default location for this file is ",(0,i.jsx)(n.em,{children:"~/.pgpass"})," in Linux, or ",(0,i.jsx)(n.em,{children:"%APPDATA%\\postgresql\\pgpass.conf"})," in Microsoft Windows, but an explicit file path can be provided through the ",(0,i.jsx)(n.code,{children:"PGPASSFILE"})," environment variable."]}),"\n",(0,i.jsx)(n.h3,{id:"encryption-password",children:"Encryption Password"}),"\n",(0,i.jsxs)(n.p,{children:["While you can set the ",(0,i.jsx)(n.code,{children:"encryptionPassword"})," (in plain text) in the settings file shown above, it is recommended that you manage it externally (and securely) and supply it at runtime using either the ",(0,i.jsx)(n.code,{children:"--postgreSqlEncryptionPassword"})," command-line argument, or by setting it in an environment variable named ",(0,i.jsx)(n.code,{children:"EdFi:ApiPublisher:ConfigurationStore:PostgreSql:EncryptionPassword"})," (in Linux use double underscores ",(0,i.jsx)(n.code,{children:"__"})," as the delimiter rather than ",(0,i.jsx)(n.code,{children:":"}),")."]})]})}function u(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},2850:(e,n,r)=>{r.d(n,{A:()=>i});const i=r.p+"assets/images/PostgreSql-configuration-store-example-457e87c92b7ded98b8040a1ef0cf5e54.png"},8453:(e,n,r)=>{r.d(n,{R:()=>s,x:()=>a});var i=r(6540);const o={},t=i.createContext(o);function s(e){const n=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);