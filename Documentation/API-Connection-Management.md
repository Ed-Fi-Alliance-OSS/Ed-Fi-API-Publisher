# API Connection Management

The Quick Start exercise supplies all connection information explicitly as command-line arguments, however to better operationalize the API Publisher you should create a Configuration Store to securely configure named API connections, and to track the state of publishing between various source and target APIs.

The Configuration Store implementation can be selected by modifying the `apiConnectionsConfigurationSource` value in the _appSettings.json_ file. Currently there are three configuration store implementations available:

| Setting Value                      | Implementation                                                                                                                                 | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| ---------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| <nobr>`sql-server`</nobr>          | Configuration Store for SQL Server ([screenshot](../images/Sql-Server-configuration-store-example.png) / [setup](Sql-Server-Configuration.md)) | Reads API connection details from and writes successfully published changed version numbers to a SQL Server settings table. Enables management of individual connection settings with encryption support for securely storing keys and secrets.                                                                                                                                                                                                                                                                                                                              |
| <nobr>`aws-parameter-store`</nobr> | Configuration Store for AWS Parameter Store ([screenshot](../images/Aws-Parameter-Store-configuration-store-example.png))                      | Reads API connection details from and writes successfully published changed version numbers to the [AWS Systems Manager Parameter Store](https://docs.aws.amazon.com/systems-manager/latest/userguide/systems-manager-parameter-store.html) using the AWS region specified in the `AWS` property of the _appSettings.json_ file. It also assumes the runtime environment has been initialized with the necessary credentials for accessing AWS services. Enables management of individual connection settings with encryption support for securely storing keys and secrets. |
| `plaintext`                        | Plain Text Configuration Store                                                                                                                 | Reads connection information defined in plain text in the _plainTextNamedConnection.json file_. Intended for development use only. Does not support writing back the successfully published Change Version.                                                                                                                                                                                                                                                                                                                                                                  |

## Defining API Connections

Regardless of the configuration store implementation in use, the configuration settings needed for defining a named API connection are described below.

| Parameter Name                                                                           | Type         | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| ---------------------------------------------------------------------------------------- | ------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| /ed-fi/publisher/connections/_{connectionName}_/url                                      | String       | The base URL of the Ed-Fi ODS API (up to, but not including, the _/data/v3_ portion of the URL).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| /ed-fi/publisher/connections/_{connectionName}_/key                                      | SecureString | The key to use for API authentication.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| /ed-fi/publisher/connections/_{connectionName}_/secret                                   | SecureString | The secret to use for API authentication.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| /ed-fi/publisher/connections/_{connectionName}_/force                                    | String       | (_Optional_) A boolean value (true/false) indicating whether the source Ed-Fi ODS API data should be published even if it does not support an isolated context for processing through Change Query snapshots.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| /ed-fi/connector/connections/_{connectionName}_/resources                                | String       | _(Optional)_ For _source_ API connections, the resources to publish to the target. The value is defined using a CSV format (comma-separated values), and should contain the partial paths to the resources (e.g. _/ed-fi/students_,_/custom/busRoutes_). For convenience when working with Ed-Fi standard resources, only the name is required (e.g. _students,studentSchoolAssociations_). The Ed-Fi API Publisher will also evaluate and automatically include all dependencies of the requested resources (using the dependency metadata exposed by the target API). This will ensure (barring misconfigured authorization metadata or data policies) that data can be successfully published to the target API. |
| /ed-fi/connector/connections/_{connectionName}_/excludeResources                         | String       | _(Optional)_ For _source_ API connections, the resources to NOT publish to the target. The value is defined using the same format as with the "resources" setting (see above). The Ed-Fi API Publisher will also evaluate and automatically exclude all dependent resources of the excluded resources (using the dependency metadata exposed by the target API). This will ensure (barring misconfigured authorization metadata or data policies) that data can be successfully published to the target API. This setting is mutually exclusive with the "resources" setting, which take precedence if both are provided.                                                                                           |
| <nobr>/ed-fi/connector/connections/_{connectionName}_/lastChangeVersionsProcessed</nobr> | String       | _(Optional)_ For _source_ API connections, contains a JSON object, keyed by target API name, that indicates the last change version successfully published from the source to the target. This value is automatically created/updated by the Ed-Fi API Publisher after successfully completing the publishing process.                                                                                                                                                                                                                                                                                                                                                                                              |
